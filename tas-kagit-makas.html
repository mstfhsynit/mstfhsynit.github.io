<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Online Ta≈ü Kaƒüƒ±t Makas</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{
  margin:0;
  font-family:Arial;
  background:linear-gradient(135deg,#1d2671,#c33764);
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
.box{
  width:440px;
  background:rgba(0,0,0,.45);
  padding:20px;
  border-radius:18px;
}
h1{text-align:center;margin:0}
input,button{
  width:100%;
  padding:8px;
  margin:5px 0;
  border:none;
  border-radius:8px;
}
button{cursor:pointer;font-size:16px}
.buttons{
  display:flex;
  justify-content:space-between;
  margin:10px 0;
}
.buttons button{
  width:30%;
  font-size:32px;
}
.score{
  display:flex;
  justify-content:space-between;
  margin:6px 0;
}
#status,#timer{text-align:center;font-weight:bold}

.chat{
  background:#222;
  padding:6px;
  height:120px;
  overflow:auto;
  border-radius:8px;
  margin-top:10px;
}
.chat-msg{
  max-width:75%;
  padding:6px 8px;
  margin:4px 0;
  border-radius:10px;
  clear:both;
}
.me{background:#4caf50;float:right;text-align:right}
.enemy{background:#555;float:left;text-align:left}

.footer{
  text-align:center;
  font-size:12px;
  margin-top:8px;
  opacity:.8;
}
.codeBox{
  text-align:center;
  font-size:20px;
  margin:8px 0;
  background:#000;
  padding:6px;
  border-radius:8px;
}
</style>
</head>

<body>
<div class="box">

<h1>‚úä ‚úã ‚úåÔ∏è</h1>

<div id="login">
  <input id="name" placeholder="ƒ∞smin">
  <button onclick="createRoom()">Oda Olu≈ütur</button>
  <div id="roomCode" class="codeBox" style="display:none"></div>
</div>

<div id="game" style="display:none">
  <div class="score">
    <div><span id="p1">-</span>: <b id="s1">0</b></div>
    <div>El <b id="round">0</b>/10</div>
    <div><span id="p2">-</span>: <b id="s2">0</b></div>
  </div>

  <div id="timer">‚è±Ô∏è 5</div>

  <div class="buttons">
    <button onclick="play('tas')">‚úä</button>
    <button onclick="play('kagit')">‚úã</button>
    <button onclick="play('makas')">‚úåÔ∏è</button>
  </div>

  <div id="status">Rakip bekleniyor‚Ä¶</div>

  <div class="chat" id="chat"></div>
  <input id="msg" placeholder="Mesaj yaz">
  <button onclick="send()">G√∂nder</button>
</div>

<div class="footer">Menfaati bitenin ihaneti ba≈ülar.</div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyBUpSbXWiF7f7pCkDaqOxI5bIseIMdzvnQ",
  authDomain:"tkm-online-e9c2b.firebaseapp.com",
  databaseURL:"https://tkm-online-e9c2b-default-rtdb.firebaseio.com",
  projectId:"tkm-online-e9c2b"
});
const db=firebase.database();

let me="",room="",isHost=true,t=5,interval=null;
const el=id=>document.getElementById(id);

function genCode(){
  return Math.random().toString(36).substring(2,7).toUpperCase();
}

function createRoom(){
  me=el("name").value.trim();
  if(!me)return alert("ƒ∞sim gir");

  room=genCode();
  el("roomCode").style.display="block";
  el("roomCode").innerText="ODA KODU: "+room;

  db.ref("rooms/"+room).set({
    p1:me,s1:0,
    p2:null,s2:0,
    round:0
  });

  el("game").style.display="block";
  listen();
}

function startTimer(){
  clearInterval(interval);
  t=5;
  timer.innerText="‚è±Ô∏è "+t;
  interval=setInterval(()=>{
    t--;
    timer.innerText="‚è±Ô∏è "+t;
    if(t<=0){
      clearInterval(interval);
      if(isHost){
        db.ref("rooms/"+room).update({round:+round.innerText+1,moves:null});
      }
    }
  },1000);
}

function play(c){
  db.ref("rooms/"+room+"/moves/"+me).once("value",s=>{
    if(s.exists())return;
    db.ref("rooms/"+room+"/moves/"+me).set(c);
  });
}

function listen(){
  db.ref("rooms/"+room).on("value",s=>{
    const d=s.val(); if(!d)return;

    p1.innerText=d.p1||"-";
    p2.innerText=d.p2||"Bekleniyor";
    s1.innerText=d.s1||0;
    s2.innerText=d.s2||0;
    round.innerText=d.round||0;

    if(d.round>=10){
      status.innerText=
        d.s1>d.s2?`üèÜ Kazanan: ${d.p1}`:
        d.s2>d.s1?`üèÜ Kazanan: ${d.p2}`:"ü§ù Berabere";
      clearInterval(interval);
      return;
    }

    if(!d.moves && d.p2)startTimer();

    if(d.moves && Object.keys(d.moves).length===2){
      clearInterval(interval);
      const [a,b]=Object.keys(d.moves);
      const m1=d.moves[a],m2=d.moves[b];
      let w=null;
      if(m1!==m2){
        if(
          (m1==="tas"&&m2==="makas")||
          (m1==="kagit"&&m2==="tas")||
          (m1==="makas"&&m2==="kagit")
        )w=a;else w=b;
      }
      if(isHost){
        const up={round:d.round+1,moves:null};
        if(w===d.p1)up.s1=d.s1+1;
        if(w===d.p2)up.s2=d.s2+1;
        db.ref("rooms/"+room).update(up);
      }
    }

    if(d.chat){
      let html="";
      Object.values(d.chat).forEach(c=>{
        html+=`<div class="chat-msg ${c.n===me?"me":"enemy"}">
        <b>${c.n}</b><br>${c.m}</div>`;
      });
      chat.innerHTML=html;
      chat.scrollTop=9999;
    }
  });
}

function send(){
  if(!msg.value)return;
  db.ref("rooms/"+room+"/chat").push({n:me,m:msg.value});
  msg.value="";
}
</script>
</body>
</html>
