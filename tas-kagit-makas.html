<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Online TaÅŸ KaÄŸÄ±t Makas</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase CDN -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body {
  margin: 0;
  font-family: Arial;
  background: linear-gradient(135deg,#1d2671,#c33764);
  color: #fff;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

.box {
  width: 380px;
  background: rgba(0,0,0,.4);
  padding: 20px;
  border-radius: 15px;
}

input, button {
  width: 100%;
  padding: 10px;
  margin-top: 8px;
  border-radius: 8px;
  border: none;
  font-size: 15px;
}

button {
  cursor: pointer;
  background: #fff;
}

.hidden { display:none; }

.buttons {
  display: flex;
  justify-content: space-between;
  margin-top: 10px;
}
.buttons button {
  width: 30%;
  font-size: 30px;
}

.chat {
  background: rgba(255,255,255,.1);
  height: 120px;
  overflow-y: auto;
  padding: 5px;
  border-radius: 8px;
  margin-top: 10px;
}

.msg.me { text-align: right; color: #7CFC00; }
.msg.other { text-align: left; color: #00BFFF; }

.footer {
  margin-top: 8px;
  font-size: 12px;
  text-align: center;
  opacity: .8;
}
</style>
</head>

<body>

<div class="box">

<!-- GÄ°RÄ°Å -->
<div id="login">
  <h3>Online TaÅŸ KaÄŸÄ±t Makas</h3>
  <input id="playerName" placeholder="Ä°smin">
  <button onclick="createRoom()">Oda OluÅŸtur</button>
  <input id="roomInput" placeholder="Oda Kodu">
  <button onclick="joinRoom()">Odaya KatÄ±l</button>
  <div id="roomCode"></div>
</div>

<!-- OYUN -->
<div id="game" class="hidden">
  <div id="players"></div>
  <div>El: <span id="round">1</span> / 10 | â±ï¸ <span id="time">5</span></div>

  <div class="buttons">
    <button onclick="play('tas')">âœŠ</button>
    <button onclick="play('kagit')">âœ‹</button>
    <button onclick="play('makas')">âœŒï¸</button>
  </div>

  <div id="result"></div>

  <div class="chat" id="chat"></div>
  <input id="chatInput" placeholder="Mesaj yaz" onkeydown="sendMsg(event)">

  <div class="footer">
    Menfaati bitenin ihaneti baÅŸlar.
  </div>
</div>

</div>

<script>
// ğŸ”¥ Firebase config
firebase.initializeApp({
  apiKey: "AIzaSyBUpSbXWiF7f7pCkDaqOxI5bIseIMdzvnQ",
  authDomain: "tkm-online-e9c2b.firebaseapp.com",
  databaseURL: "https://tkm-online-e9c2b-default-rtdb.firebaseio.com",
  projectId: "tkm-online-e9c2b"
});

const db = firebase.database();

let room, me, role, timer, time = 5;

// ğŸ”‘ ODA OLUÅTUR
function createRoom(){
  me = playerName.value.trim();
  if(!me) return alert("Ä°sim gir");

  room = Math.random().toString(36).substring(2,7).toUpperCase();
  role = "p1";

  db.ref("rooms/"+room).set({
    round:1,
    status:"waiting",
    players:{
      p1:{name:me,score:0,choice:""}
    }
  });

  roomCode.innerText = "Oda Kodu: "+room;
  startListen();
}

// ğŸšª ODAYA KATIL
function joinRoom(){
  me = playerName.value.trim();
  room = roomInput.value.trim().toUpperCase();
  if(!me || !room) return alert("Eksik bilgi");

  role = "p2";
  db.ref("rooms/"+room+"/players/p2").set({name:me,score:0,choice:""});
  startListen();
}

// ğŸ§ DÄ°NLE
function startListen(){
  login.classList.add("hidden");
  game.classList.remove("hidden");

  db.ref("rooms/"+room).on("value",snap=>{
    const d = snap.val();
    if(!d) return;

    players.innerText =
      d.players.p1.name+" ("+d.players.p1.score+")  vs  "+
      (d.players.p2?d.players.p2.name:"Bekleniyor")+" ("+(d.players.p2?d.players.p2.score:0)+")";

    round.innerText = d.round;

    if(d.players.p1.choice && d.players.p2?.choice){
      clearInterval(timer);
      decide(d);
    }
  });

  db.ref("rooms/"+room+"/chat").on("child_added",s=>{
    const m = s.val();
    const div = document.createElement("div");
    div.className = "msg "+(m.name===me?"me":"other");
    div.innerText = m.name+": "+m.text;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
  });

  startTimer();
}

// â±ï¸ TIMER
function startTimer(){
  time=5;
  timeEl = document.getElementById("time");
  timer = setInterval(()=>{
    time--;
    timeEl.innerText=time;
    if(time<=0){
      clearInterval(timer);
      play("none");
    }
  },1000);
}

// ğŸ® HAMLE
function play(c){
  db.ref("rooms/"+room+"/players/"+role+"/choice").set(c);
}

// ğŸ§  SONUÃ‡
function decide(d){
  const a=d.players.p1.choice,b=d.players.p2.choice;
  let win=null;

  if(a!==b){
    if(
      (a=="tas"&&b=="makas")||
      (a=="kagit"&&b=="tas")||
      (a=="makas"&&b=="kagit")
    ) win="p1"; else win="p2";
  }

  if(win){
    d.players[win].score++;
    result.innerText="Kazanan: "+d.players[win].name;
  } else result.innerText="Berabere";

  if(d.round>=10){
    const w=d.players.p1.score>d.players.p2.score?d.players.p1.name:d.players.p2.name;
    alert("ğŸ† Kazanan: "+w);
    db.ref("rooms/"+room).remove();
    location.reload();
    return;
  }

  db.ref("rooms/"+room).update({
    round:d.round+1,
    "players/p1/choice":"",
    "players/p2/choice":""
  });

  startTimer();
}

// ğŸ’¬ CHAT
function sendMsg(e){
  if(e.key!=="Enter") return;
  db.ref("rooms/"+room+"/chat").push({name:me,text:chatInput.value});
  chatInput.value="";
}
</script>

</body>
</html>
