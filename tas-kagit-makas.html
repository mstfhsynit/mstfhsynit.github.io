<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Online TaÅŸ KaÄŸÄ±t Makas</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body{
  margin:0;
  background:linear-gradient(135deg,#1d2671,#c33764);
  font-family:Arial,sans-serif;
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
}

.app{
  width:420px;
  background:rgba(0,0,0,.45);
  border-radius:20px;
  padding:20px;
  text-align:center;
}

h1{margin:5px 0}

.panel{
  background:rgba(255,255,255,.1);
  border-radius:12px;
  padding:10px;
  margin:10px 0;
}

.players{
  display:flex;
  justify-content:space-between;
  font-weight:bold;
}

.score{
  font-size:22px;
  margin-top:5px;
}

.buttons{
  display:flex;
  justify-content:space-around;
  margin:15px 0;
}

.buttons button{
  width:90px;
  height:90px;
  font-size:40px;
  border:none;
  border-radius:50%;
  cursor:pointer;
  transition:.2s;
}

.buttons button:hover{transform:scale(1.15)}

.status{
  min-height:50px;
  font-size:16px;
  margin-top:5px;
}

.win{color:#00ffae}
.lose{color:#ff7070}

input,button{
  padding:8px;
  border-radius:8px;
  border:none;
}

button{
  cursor:pointer;
}

.footer{
  font-size:12px;
  opacity:.85;
  margin-top:10px;
  font-style:italic;
}
</style>
</head>

<body>
<div class="app">

<h1>âœŠ âœ‹ âœŒï¸</h1>
<b>Online TaÅŸ KaÄŸÄ±t Makas</b>

<div class="panel">
  <input id="name" placeholder="Ä°smin" />
  <button onclick="create()">Oda OluÅŸtur</button>
  <br><br>
  <input id="room" placeholder="Oda Kodu" />
  <button onclick="join()">KatÄ±l</button>
</div>

<div class="panel players">
  <div id="p1">â€”</div>
  <div id="p2">â€”</div>
</div>

<div class="panel score">
  Sen <span id="s1">0</span> â€” <span id="s2">0</span> Rakip
  <div>El: <span id="round">0</span> / 10</div>
</div>

<div class="buttons">
  <button onclick="choose('tas')">âœŠ</button>
  <button onclick="choose('kagit')">âœ‹</button>
  <button onclick="choose('makas')">âœŒï¸</button>
</div>

<div class="status" id="status">Oda bekleniyorâ€¦</div>

<div class="panel">
  <button onclick="rematch()">ğŸ” RÃ¶vanÅŸ</button>
</div>

<div class="footer">
  Menfaati bitenin ihaneti baÅŸlar.
</div>

</div>

<script>
// ğŸ”¥ Firebase
firebase.initializeApp({
  apiKey:"AIzaSyBUpSbXWiF7f7pCkDaqOxI5bIseIMdzvnQ",
  databaseURL:"https://tkm-online-e9c2b-default-rtdb.firebaseio.com"
});
const db=firebase.database();

// âš™ï¸ DeÄŸiÅŸkenler
let room="",me="",role="";
const WIN=10;

// ğŸ® YardÄ±mcÄ±
const el=i=>document.getElementById(i);
const rnd=()=> "p"+Math.floor(Math.random()*9999);

// ğŸ  ODA
function create(){
  me=el("name").value||"Oyuncu";
  room=rnd();
  role="p1";
  db.ref(room).set({
    round:0,
    players:{
      p1:{name:me,score:0},
      p2:{name:"Bekleniyor",score:0}
    }
  });
  listen();
  el("status").innerText="Oda kodu: "+room;
}

function join(){
  me=el("name").value||"Oyuncu";
  room=el("room").value;
  role="p2";
  db.ref(room+"/players/p2").update({name:me});
  listen();
}

// ğŸ‘‚ Dinleme
function listen(){
  db.ref(room).on("value",s=>{
    if(!s.exists())return;
    const d=s.val();
    el("p1").innerText=d.players.p1.name;
    el("p2").innerText=d.players.p2.name;
    el("s1").innerText=d.players.p1.score;
    el("s2").innerText=d.players.p2.score;
    el("round").innerText=d.round;

    if(d.players.p1.score>=WIN||d.players.p2.score>=WIN){
      const w=d.players.p1.score>d.players.p2.score
        ?d.players.p1.name:d.players.p2.name;
      el("status").innerHTML="ğŸ† Kazanan: <b>"+w+"</b>";
      el("status").className="status win";
    }
  });
}

// âœŠ OYUN
function choose(c){
  const ref=db.ref(room);
  ref.once("value",s=>{
    const d=s.val();
    if(d.round>=WIN*2)return;

    const enemy=role==="p1"?"p2":"p1";
    const e=d.players[enemy].choice;

    db.ref(room+"/players/"+role+"/choice").set(c);

    if(e){
      const res=calc(c,e);
      if(res===1)d.players[role].score++;
      if(res===-1)d.players[enemy].score++;
      d.round++;
      d.players.p1.choice=null;
      d.players.p2.choice=null;
      ref.set(d);
    }
  });
}

function calc(a,b){
  if(a===b)return 0;
  if((a==="tas"&&b==="makas")||(a==="kagit"&&b==="tas")||(a==="makas"&&b==="kagit"))return 1;
  return -1;
}

// ğŸ” RÃ–VANÅ
function rematch(){
  db.ref(room).update({
    round:0,
    players:{
      p1:{score:0},
      p2:{score:0}
    }
  });
  el("status").innerText="Yeni oyun baÅŸladÄ±!";
  el("status").className="status";
}
</script>
</body>
</html>
