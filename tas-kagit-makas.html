<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Online TaÅŸ KaÄŸÄ±t Makas</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  height:100vh;
  background:linear-gradient(135deg,#1d2671,#c33764);
  display:flex;
  justify-content:center;
  align-items:center;
  font-family:Arial;
  color:white;
}
.game{
  width:360px;
  background:rgba(0,0,0,.45);
  padding:20px;
  border-radius:18px;
  text-align:center;
}
.buttons button{
  width:90px;height:90px;
  font-size:40px;
  border:none;
  border-radius:50%;
  cursor:pointer;
}
#chat{
  margin-top:10px;
  height:80px;
  overflow:auto;
  background:rgba(255,255,255,.1);
  padding:6px;
  font-size:13px;
}
input{
  width:100%;
  padding:6px;
  border:none;
  border-radius:6px;
  margin-top:5px;
}
</style>
</head>

<body>

<div class="game">
<h2 id="names">Oyuncular</h2>

<div class="buttons">
<button onclick="play('tas')">âœŠ</button>
<button onclick="play('kagit')">âœ‹</button>
<button onclick="play('makas')">âœŒï¸</button>
</div>

<div id="result">SeÃ§im yap</div>

<div id="roundScore">ğŸ‘¤ 0 | ğŸ§‘â€ğŸ’» 0</div>
<div id="roundInfo">El: 0 / 10</div>

<div id="winner"></div>

<div id="chat"></div>
<input id="msg" placeholder="Mesaj yaz..."
onkeydown="if(event.key==='Enter')sendMsg()">

<p style="font-size:12px;margin-top:8px">
Menfaati bitenin ihaneti baÅŸlar.
</p>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBUpSbXWiF7f7pCkDaqOxI5bIseIMdzvnQ",
  authDomain: "tkm-online-e9c2b.firebaseapp.com",
  databaseURL: "https://tkm-online-e9c2b-default-rtdb.firebaseio.com",
  projectId: "tkm-online-e9c2b",
  appId: "1:967040600662:web:2b01ff890db04936cc09f7"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const room = "oda1";
const playerId = "p" + Math.floor(Math.random()*10000);
let myName = prompt("AdÄ±n?");
db.ref(room+"/players/"+playerId).set({name:myName,score:0});

db.ref(room+"/players").on("value",s=>{
  let t=[];
  s.forEach(c=>t.push(c.val().name));
  document.getElementById("names").innerText=t.join(" vs ");
});

function play(choice){
  db.ref(room+"/moves/"+playerId).set(choice);
}

db.ref(room+"/moves").on("value",snap=>{
  const m=snap.val();
  if(!m||Object.keys(m).length<2)return;

  const ids=Object.keys(m);
  const a=m[ids[0]], b=m[ids[1]];

  let r="";
  if(a===b) r="Berabere";
  else if(
    (a==="tas"&&b==="makas")||
    (a==="kagit"&&b==="tas")||
    (a==="makas"&&b==="kagit")
  ){
    r="Kazanan: "+ids[0];
    db.ref(room+"/players/"+ids[0]+"/score").transaction(s=>(s||0)+1);
  }else{
    r="Kazanan: "+ids[1];
    db.ref(room+"/players/"+ids[1]+"/score").transaction(s=>(s||0)+1);
  }

  db.ref(room+"/round").transaction(n=>(n||0)+1);
  document.getElementById("result").innerText=r;
  db.ref(room+"/moves").remove();
});

db.ref(room+"/players").on("value",s=>{
  let vals=Object.values(s.val()||{});
  if(vals.length<2)return;
  document.getElementById("roundScore").innerText=
  `ğŸ‘¤ ${vals[0].score||0} | ğŸ§‘â€ğŸ’» ${vals[1].score||0}`;
});

db.ref(room+"/round").on("value",s=>{
  const r=s.val()||0;
  document.getElementById("roundInfo").innerText=`El: ${r} / 10`;
  if(r>=10){
    db.ref(room+"/players").once("value",p=>{
      let v=Object.values(p.val());
      document.getElementById("winner").innerText=
      v[0].score>v[1].score?"ğŸ‰ KazandÄ±n":"ğŸ˜¢ Kaybettin";
    });
  }
});

function sendMsg(){
  const m=document.getElementById("msg");
  db.ref(room+"/chat").push(myName+": "+m.value);
  m.value="";
}
db.ref(room+"/chat").on("child_added",s=>{
  document.getElementById("chat").innerHTML+=s.val()+"<br>";
});
</script>
</body>
</html>
