<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Online TaÅŸ KaÄŸÄ±t Makas</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body{
  margin:0;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:linear-gradient(135deg,#1d2671,#c33764);
  font-family:Arial;
  color:#fff;
}

.box{
  width:360px;
  background:rgba(0,0,0,.45);
  padding:20px;
  border-radius:16px;
  box-shadow:0 20px 40px rgba(0,0,0,.5);
}

h2{text-align:center;margin-top:0}

input,button{
  width:100%;
  padding:10px;
  margin-top:8px;
  border:none;
  border-radius:8px;
  font-size:15px;
}

button{
  cursor:pointer;
  background:#fff;
  font-weight:bold;
}

button:hover{opacity:.9}

#roomCode{
  margin-top:10px;
  text-align:center;
  font-size:18px;
  font-weight:bold;
  color:#7CFC00;
}

.hidden{display:none}

.info{
  text-align:center;
  margin-top:10px;
  font-size:14px;
}

.footer{
  margin-top:12px;
  font-size:12px;
  text-align:center;
  opacity:.8;
}
</style>
</head>

<body>

<div class="box">

<!-- GÄ°RÄ°Åž -->
<div id="login">
  <h2>TaÅŸ â€¢ KaÄŸÄ±t â€¢ Makas</h2>

  <input id="playerName" placeholder="Ä°smin">

  <button onclick="createRoom()">Oda OluÅŸtur</button>

  <div id="roomCode"></div>

  <hr style="margin:15px 0;opacity:.3">

  <input id="roomInput" placeholder="Oda Kodu">
  <button onclick="joinRoom()">Odaya KatÄ±l</button>

  <div class="footer">
    Menfaati bitenin ihaneti baÅŸlar.
  </div>
</div>

<!-- OYUN -->
<div id="game" class="hidden">
  <h2>Odaya BaÄŸlandÄ±n</h2>
  <div id="players" class="info"></div>
</div>

</div>

<script>
// ðŸ”¥ Firebase config
firebase.initializeApp({
  apiKey: "AIzaSyBUpSbXWiF7f7pCkDaqOxI5bIseIMdzvnQ",
  authDomain: "tkm-online-e9c2b.firebaseapp.com",
  databaseURL: "https://tkm-online-e9c2b-default-rtdb.firebaseio.com",
  projectId: "tkm-online-e9c2b"
});

const db = firebase.database();

let room = "";
let me = "";
let role = "";

// ðŸŸ¢ ODA OLUÅžTUR
function createRoom(){
  const nameInput = document.getElementById("playerName");
  const roomCodeDiv = document.getElementById("roomCode");

  if(!nameInput || !roomCodeDiv){
    alert("HTML elemanÄ± eksik");
    return;
  }

  me = nameInput.value.trim();
  if(me === ""){
    alert("Ä°smini yaz");
    return;
  }

  room = Math.random().toString(36).substring(2,7).toUpperCase();
  role = "p1";

  db.ref("rooms/"+room).set({
    createdAt: Date.now(),
    players:{
      p1:{name:me}
    }
  }, (err)=>{
    if(err){
      alert("Firebase hatasÄ±");
      console.error(err);
    }else{
      roomCodeDiv.innerText = "ODA KODU: " + room;
      startListen();
    }
  });
}

// ðŸ”µ ODAYA KATIL
function joinRoom(){
  const nameInput = document.getElementById("playerName");
  const roomInput = document.getElementById("roomInput");

  me = nameInput.value.trim();
  room = roomInput.value.trim().toUpperCase();

  if(me==="" || room===""){
    alert("Ä°sim ve oda kodu gerekli");
    return;
  }

  role = "p2";

  db.ref("rooms/"+room+"/players/p2").set({name:me}, (err)=>{
    if(err){
      alert("Odaya girilemedi");
    }else{
      startListen();
    }
  });
}

// ðŸŽ§ ODAYI DÄ°NLE
function startListen(){
  document.getElementById("login").classList.add("hidden");
  document.getElementById("game").classList.remove("hidden");

  db.ref("rooms/"+room).on("value", snap=>{
    const data = snap.val();
    if(!data) return;

    const p1 = data.players.p1?.name || "â€”";
    const p2 = data.players.p2?.name || "Bekleniyor";

    document.getElementById("players").innerText =
      "Oyuncular: " + p1 + " vs " + p2;
  });
}
</script>

</body>
</html>
