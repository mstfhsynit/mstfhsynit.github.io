<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Online TaÅŸ KaÄŸÄ±t Makas</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<!-- Konfeti -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
body{
  margin:0;
  min-height:100vh;
  background:linear-gradient(135deg,#1d2671,#c33764);
  font-family:Arial,sans-serif;
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
}

.app{
  width:440px;
  background:rgba(0,0,0,.5);
  border-radius:20px;
  padding:20px;
}

h1{text-align:center;margin:5px}

.panel{
  background:rgba(255,255,255,.1);
  border-radius:12px;
  padding:10px;
  margin:10px 0;
}

input,button{
  padding:8px;
  border-radius:8px;
  border:none;
  margin:3px;
}

button{cursor:pointer}

.players{
  display:flex;
  justify-content:space-between;
  font-weight:bold;
}

.score{
  text-align:center;
  font-size:22px;
}

.buttons{
  display:flex;
  justify-content:space-around;
  margin:15px 0;
}

.buttons button{
  width:90px;
  height:90px;
  font-size:40px;
  border-radius:50%;
}

.status{
  min-height:50px;
  text-align:center;
  margin-top:8px;
}

.chat{
  height:120px;
  overflow:auto;
  background:#0003;
  padding:6px;
  border-radius:8px;
  font-size:13px;
}

.footer{
  text-align:center;
  font-size:12px;
  opacity:.8;
  font-style:italic;
}
</style>
</head>

<body>
<div class="app">

<h1>âœŠ âœ‹ âœŒï¸</h1>
<b style="display:block;text-align:center">Online TaÅŸ KaÄŸÄ±t Makas</b>

<div class="panel">
  <input id="name" placeholder="Ä°smin">
  <button onclick="create()">Oda OluÅŸtur</button><br>
  <input id="room" placeholder="Oda Kodu">
  <button onclick="join()">KatÄ±l</button>
</div>

<div class="panel players">
  <div id="p1">â€”</div>
  <div id="p2">â€”</div>
</div>

<div class="panel score">
  Sen <span id="s1">0</span> â€” <span id="s2">0</span> Rakip<br>
  El: <span id="round">0</span> / 10
</div>

<div class="buttons">
  <button onclick="choose('tas')">âœŠ</button>
  <button onclick="choose('kagit')">âœ‹</button>
  <button onclick="choose('makas')">âœŒï¸</button>
</div>

<div class="status" id="status">Oda bekleniyorâ€¦</div>

<div class="panel">
  <div class="chat" id="chat"></div>
  <input id="msg" placeholder="Mesaj yaz">
  <button onclick="send()">GÃ¶nder</button>
</div>

<div class="panel">
  <button onclick="rematch()">ğŸ” RÃ¶vanÅŸ</button>
</div>

<div class="footer">
  Menfaati bitenin ihaneti baÅŸlar.
</div>

</div>

<script>
// ğŸ”¥ Firebase
firebase.initializeApp({
  apiKey:"AIzaSyBUpSbXWiF7f7pCkDaqOxI5bIseIMdzvnQ",
  databaseURL:"https://tkm-online-e9c2b-default-rtdb.firebaseio.com"
});
const db=firebase.database();

let room="",me="",role="";
const WIN=10;

const el=i=>document.getElementById(i);
const rnd=()=> "r"+Math.floor(Math.random()*9999);

// ğŸ  ODA
function create(){
  me=el("name").value||"Oyuncu";
  room=rnd(); role="p1";
  db.ref(room).set({
    round:0,
    chat:[],
    players:{
      p1:{name:me,score:0},
      p2:{name:"Bekleniyor",score:0}
    }
  });
  listen();
  el("status").innerText="Oda kodu: "+room;
}

function join(){
  me=el("name").value||"Oyuncu";
  room=el("room").value; role="p2";
  db.ref(room+"/players/p2").update({name:me});
  listen();
}

// ğŸ‘‚ DÄ°NLE
function listen(){
  db.ref(room).on("value",s=>{
    if(!s.exists())return;
    const d=s.val();
    el("p1").innerText=d.players.p1.name;
    el("p2").innerText=d.players.p2.name;
    el("s1").innerText=d.players.p1.score;
    el("s2").innerText=d.players.p2.score;
    el("round").innerText=d.round;

    if(d.chat){
      el("chat").innerHTML=d.chat.map(c=>`<div><b>${c.n}:</b> ${c.m}</div>`).join("");
      el("chat").scrollTop=9999;
    }

    if(d.players.p1.score>=WIN||d.players.p2.score>=WIN){
      const w=d.players.p1.score>d.players.p2.score
        ?d.players.p1.name:d.players.p2.name;
      el("status").innerHTML="ğŸ† KAZANAN: <b>"+w+"</b>";
      confetti();
    }
  });
}

// âœŠ OYUN
function choose(c){
  const ref=db.ref(room);
  ref.once("value",s=>{
    const d=s.val();
    if(d.round>=WIN*2)return;
    const e=role==="p1"?"p2":"p1";
    db.ref(room+"/players/"+role+"/choice").set(c);

    if(d.players[e].choice){
      const r=calc(c,d.players[e].choice);
      if(r===1)d.players[role].score++;
      if(r===-1)d.players[e].score++;
      d.round++;
      d.players.p1.choice=null;
      d.players.p2.choice=null;
      ref.set(d);
    }
  });
}

function calc(a,b){
  if(a===b)return 0;
  if((a==="tas"&&b==="makas")||(a==="kagit"&&b==="tas")||(a==="makas"&&b==="kagit"))return 1;
  return -1;
}

// ğŸ’¬ CHAT
function send(){
  const m=el("msg").value;
  if(!m)return;
  db.ref(room+"/chat").push({n:me,m});
  el("msg").value="";
}

// ğŸ” RÃ–VANÅ
function rematch(){
  db.ref(room+"/round").set(0);
  db.ref(room+"/players/p1/score").set(0);
  db.ref(room+"/players/p2/score").set(0);
  el("status").innerText="Yeni oyun baÅŸladÄ±!";
}
</script>
</body>
</html>
