<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dijital Yapboz</title>
<style>
body {
  font-family: sans-serif;
  text-align: center;
  background: #f0f0f0;
  padding-top: 20px;
}
h1 { margin-bottom: 10px; }
#file-input { margin-bottom: 20px; }
#puzzle-container {
  position: relative;
  width: 360px;
  height: 360px;
  margin: auto;
  border: 2px solid #333;
}
#background {
  width: 360px;
  height: 360px;
  position: absolute;
  top: 0;
  left: 0;
  z-index: 0;
  object-fit: cover;
}
.piece {
  width: 120px;
  height: 120px;
  position: absolute;
  border: 1px solid #555;
  cursor: grab;
  z-index: 1;
}
.piece img {
  width: 360px;
  height: 360px;
  object-fit: none;
  position: absolute;
  top: 0;
  left: 0;
}
</style>
</head>
<body>
<h1>Dijital Yapboz</h1>
<input type="file" id="file-input" accept="image/*"><br>
<div id="puzzle-container">
  <img id="background" src="" alt="Yapboz Alt Resim">
</div>

<script>
const container = document.getElementById('puzzle-container');
const fileInput = document.getElementById('file-input');
let pieces = [];
let dragged = null;

fileInput.addEventListener('change', (e) => {
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = function(event){
    const src = event.target.result;
    document.getElementById('background').src = src;
    createPuzzle(src);
  }
  reader.readAsDataURL(file);
});

function createPuzzle(src){
  // Ã–nce mevcut bloklarÄ± kaldÄ±r
  pieces.forEach(p => p.remove());
  pieces = [];

  const size = 120; // blok boyutu
  let positions = [];

  for(let row=0; row<3; row++){
    for(let col=0; col<3; col++){
      let div = document.createElement('div');
      div.className = 'piece';
      div.draggable = true;
      div.dataset.id = row*3 + col + 1;
      div.style.top = `${row*size}px`;
      div.style.left = `${col*size}px`;

      // Blok iÃ§ine tam resim ama sadece kendi parÃ§asÄ± gÃ¶rÃ¼nÃ¼r
      let img = document.createElement('img');
      img.src = src;
      img.style.left = `-${col*size}px`;
      img.style.top = `-${row*size}px`;
      div.appendChild(img);

      container.appendChild(div);
      pieces.push(div);
      positions.push({top: div.style.top, left: div.style.left});
    }
  }

  // KarÄ±ÅŸtÄ±r
  positions.sort(() => Math.random() - 0.5);
  pieces.forEach((p,i)=>{
    p.style.top = positions[i].top;
    p.style.left = positions[i].left;
  });

  // Drag & Drop
  pieces.forEach(p=>{
    p.addEventListener('dragstart', e => { dragged = e.target; });
    p.addEventListener('dragover', e => e.preventDefault());
    p.addEventListener('drop', e => {
      e.preventDefault();
      if(e.target.classList.contains('piece') && e.target!==dragged){
        // Pozisyon deÄŸiÅŸimi
        let tempTop = dragged.style.top;
        let tempLeft = dragged.style.left;
        dragged.style.top = e.target.style.top;
        dragged.style.left = e.target.style.left;
        e.target.style.top = tempTop;
        e.target.style.left = tempLeft;

        // ID deÄŸiÅŸimi
        let tempID = dragged.dataset.id;
        dragged.dataset.id = e.target.dataset.id;
        e.target.dataset.id = tempID;

        checkWin();
      }
    });
  });
}

function checkWin(){
  if(pieces.every((p,i)=>p.dataset.id == i+1)){
    alert('ðŸŽ‰ Tebrikler! Yapbozu tamamladÄ±n!');
  }
}
</script>
</body>
</html>
