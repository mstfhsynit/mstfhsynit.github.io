<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dijital Yapboz</title>
<style>
body {
  font-family: sans-serif;
  text-align: center;
  background: #eee;
  padding: 20px;
}
h1 { margin-bottom: 10px; }
#file-input { margin-bottom: 20px; }

#puzzle-container {
  position: relative;
  width: 360px;
  height: 360px;
  margin: auto;
  border: 2px solid #333;
  background-color: #fff;
}

#puzzle-container img {
  position: absolute;
  top: 0;
  left: 0;
  width: 360px;
  height: 360px;
  object-fit: cover;
  z-index: 0;
}

.piece {
  width: 120px;
  height: 120px;
  position: absolute;
  border: 1px solid #555;
  cursor: grab;
  z-index: 1;
}

.piece img {
  width: 360px;
  height: 360px;
  object-fit: none;
  position: absolute;
  top: 0;
  left: 0;
}
</style>
</head>
<body>
<h1>Dijital Yapboz (8 Par√ßa)</h1>
<input type="file" id="file-input" accept="image/*"><br>
<div id="puzzle-container">
  <img id="background" src="" alt="Alt Resim">
</div>

<script>
const fileInput = document.getElementById('file-input');
const container = document.getElementById('puzzle-container');
let pieces = [];
let imgSrc = "";

fileInput.addEventListener('change', e=>{
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = function(event){
    imgSrc = event.target.result;
    document.getElementById('background').src = imgSrc;
    createPuzzle();
  }
  reader.readAsDataURL(file);
});

function createPuzzle(){
  // Temizle
  pieces.forEach(p=>p.remove());
  pieces = [];

  const size = 120; // blok boyutu
  const positions = [
    {row:0,col:0},{row:0,col:1},{row:0,col:2},
    {row:1,col:0},           {row:1,col:2},
    {row:2,col:0},{row:2,col:1},{row:2,col:2}
  ];

  // Par√ßalarƒ± olu≈ütur
  positions.forEach((pos,index)=>{
    let div = document.createElement('div');
    div.className = 'piece';
    div.dataset.row = pos.row;
    div.dataset.col = pos.col;
    div.dataset.id = index + 1;

    let img = document.createElement('img');
    img.src = imgSrc;
    img.style.top = `-${pos.row*size}px`;
    img.style.left = `-${pos.col*size}px`;

    div.appendChild(img);
    container.appendChild(div);
    pieces.push(div);
  });

  // Karƒ±≈ütƒ±r
  shufflePieces();

  // Drag & Drop
  pieces.forEach(p=>{
    p.draggable = true;
    p.addEventListener('dragstart', e=>{
      e.dataTransfer.setData("text/plain", p.dataset.id);
    });
  });

  container.addEventListener('dragover', e=> e.preventDefault());

  container.addEventListener('drop', e=>{
    e.preventDefault();
    const id = e.dataTransfer.getData("text/plain");
    const dragged = pieces.find(p=>p.dataset.id===id);

    // ƒ∞mlecin olduƒüu yere kaydƒ±r
    const rect = container.getBoundingClientRect();
    let x = e.clientX - rect.left - 60; // ortala
    let y = e.clientY - rect.top - 60;

    // Sƒ±nƒ±rlar
    x = Math.max(0, Math.min(x, 360-120));
    y = Math.max(0, Math.min(y, 360-120));

    dragged.style.left = x + "px";
    dragged.style.top = y + "px";

    checkWin();
  });
}

function shufflePieces(){
  pieces.forEach(p=>{
    let x = Math.floor(Math.random()*3)*120;
    let y = Math.floor(Math.random()*3)*120;
    p.style.left = x + "px";
    p.style.top = y + "px";
  });
}

function checkWin(){
  const size = 120;
  const positions = [
    {row:0,col:0},{row:0,col:1},{row:0,col:2},
    {row:1,col:0},           {row:1,col:2},
    {row:2,col:0},{row:2,col:1},{row:2,col:2}
  ];
  let won = pieces.every((p,i)=>{
    let x = parseInt(p.style.left);
    let y = parseInt(p.style.top);
    return Math.abs(x - positions[i].col*size) <=5 && Math.abs(y - positions[i].row*size)<=5;
  });
  if(won){
    alert("üéâ Tebrikler! Yapbozu tamamladƒ±nƒ±z!");
  }
}
</script>
</body>
</html>
