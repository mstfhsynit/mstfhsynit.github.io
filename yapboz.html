<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KaydÄ±rmalÄ± Yapboz</title>
<style>
body {
  font-family: sans-serif;
  text-align: center;
  background: #eee;
  padding: 20px;
}
h1 { margin-bottom: 10px; }
#file-input { margin-bottom: 20px; }

#puzzle-container {
  position: relative;
  width: 360px;
  height: 360px;
  margin: auto;
  border: 2px solid #333;
  background-color: #fff;
}

#puzzle-container img {
  position: absolute;
  top:0;
  left:0;
  width:360px;
  height:360px;
  object-fit: cover;
  z-index:0;
}

.piece {
  width: 120px;
  height: 120px;
  position: absolute;
  border: 1px solid #555;
  box-sizing: border-box;
  touch-action: none; /* Dokunmatik iÃ§in */
}

.piece img {
  width: 360px;
  height: 360px;
  object-fit: none;
  position: absolute;
  top: 0;
  left: 0;
  pointer-events: none;
}
</style>
</head>
<body>
<h1>KaydÄ±rmalÄ± Yapboz</h1>
<input type="file" id="file-input" accept="image/*"><br>
<div id="puzzle-container">
  <img id="background" src="" alt="Alt Resim">
</div>

<script>
const fileInput = document.getElementById('file-input');
const container = document.getElementById('puzzle-container');
const background = document.getElementById('background');

const size = 120;
let grid = [];
let empty = {row:2,col:2};
let imgSrc = "";

fileInput.addEventListener('change', e=>{
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = function(event){
    imgSrc = event.target.result;
    background.src = imgSrc;
    createPuzzle();
  }
  reader.readAsDataURL(file);
});

function createPuzzle(){
  // Temizle
  container.querySelectorAll('.piece').forEach(p=>p.remove());
  grid = [];

  // 3x3 grid, son parÃ§a boÅŸ
  let id=1;
  for(let r=0;r<3;r++){
    for(let c=0;c<3;c++){
      if(r===2 && c===2){
        grid.push(null); // boÅŸ
        continue;
      }
      const div = document.createElement('div');
      div.className='piece';
      div.dataset.row=r;
      div.dataset.col=c;
      div.dataset.id=id;

      const img = document.createElement('img');
      img.src = imgSrc;
      img.style.top = `-${r*size}px`;
      img.style.left = `-${c*size}px`;

      div.appendChild(img);
      container.appendChild(div);
      grid.push(div);

      makeDraggable(div);
      id++;
    }
  }
  shuffle();
}

function shuffle(){
  // Basit karÄ±ÅŸtÄ±rma: 100 rastgele geÃ§iÅŸ
  for(let i=0;i<100;i++){
    const movable = getMovable();
    const p = movable[Math.floor(Math.random()*movable.length)];
    movePiece(p);
  }
}

function getMovable(){
  return grid.filter(p=>{
    if(!p) return false;
    const r=parseInt(p.dataset.row);
    const c=parseInt(p.dataset.col);
    return (Math.abs(r-empty.row)+Math.abs(c-empty.col))===1;
  });
}

function movePiece(p){
  const r=parseInt(p.dataset.row);
  const c=parseInt(p.dataset.col);

  // Pozisyon deÄŸiÅŸtir
  p.style.top = `${empty.row*size}px`;
  p.style.left = `${empty.col*size}px`;

  grid[empty.row*3+empty.col] = p;
  grid[r*3+c] = null;

  p.dataset.row = empty.row;
  p.dataset.col = empty.col;

  empty.row = r;
  empty.col = c;

  checkWin();
}

// Dokunmatik ve fare uyumlu
function makeDraggable(div){
  div.addEventListener('click', ()=>{ if(isMovable(div)) movePiece(div); });

  div.addEventListener('touchstart', e=>{
    if(isMovable(div)){
      movePiece(div);
    }
  });
}

function isMovable(p){
  const r=parseInt(p.dataset.row);
  const c=parseInt(p.dataset.col);
  return (Math.abs(r-empty.row)+Math.abs(c-empty.col))===1;
}

function checkWin(){
  let won=true;
  grid.forEach((p,i)=>{
    if(!p) return;
    const targetRow = Math.floor((p.dataset.id-1)/3);
    const targetCol = (p.dataset.id-1)%3;
    if(parseInt(p.dataset.row)!==targetRow || parseInt(p.dataset.col)!==targetCol){
      won=false;
    }
  });
  if(won) alert("ðŸŽ‰ Tebrikler! Yapbozu tamamladÄ±nÄ±z!");
}
</script>
</body>
</html>
