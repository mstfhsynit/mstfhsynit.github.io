<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>8 ParÃ§alÄ± Dijital Yapboz</title>
<style>
body {
  font-family: sans-serif;
  text-align: center;
  background: #f0f0f0;
  padding-top: 20px;
}
h1 {margin-bottom: 10px;}
#file-input {margin-bottom: 20px;}
#puzzle-container {
  position: relative;
  width: 360px;
  height: 360px;
  margin: auto;
  border: 2px solid #333;
}
#background {
  width: 360px;
  height: 360px;
  position: absolute;
  top:0;
  left:0;
  object-fit: cover;
  z-index:0;
}
.piece {
  width: 120px;
  height: 120px;
  position: absolute;
  border:1px solid #555;
  cursor: pointer;
  z-index:1;
}
.piece img {
  width: 360px;
  height: 360px;
  object-fit: none;
  position: absolute;
  top:0;
  left:0;
}
</style>
</head>
<body>
<h1>8 ParÃ§alÄ± Dijital Yapboz</h1>
<input type="file" id="file-input" accept="image/*"><br>
<div id="puzzle-container">
  <img id="background" src="" alt="Alt Resim">
</div>

<script>
const container = document.getElementById('puzzle-container');
const fileInput = document.getElementById('file-input');
const size = 120; // blok boyutu
let pieces = [];
let empty = {row:2, col:2}; // boÅŸ alan baÅŸta saÄŸ alt
let imgSrc = "";

// FotoÄŸraf yÃ¼klendiÄŸinde
fileInput.addEventListener('change', e=>{
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = function(event){
    imgSrc = event.target.result;
    document.getElementById('background').src = imgSrc;
    createPuzzle();
  }
  reader.readAsDataURL(file);
});

function createPuzzle(){
  // Temizle
  pieces.forEach(p=>p.remove());
  pieces=[];
  
  // 3x3 blok, son blok boÅŸ olacak
  let id = 1;
  for(let row=0; row<3; row++){
    for(let col=0; col<3; col++){
      if(row===2 && col===2) continue; // boÅŸ alan
      let div = document.createElement('div');
      div.className='piece';
      div.dataset.row = row;
      div.dataset.col = col;
      div.dataset.id = id;
      div.style.top = `${row*size}px`;
      div.style.left = `${col*size}px`;
      
      let img = document.createElement('img');
      img.src = imgSrc;
      img.style.top = `-${row*size}px`;
      img.style.left = `-${col*size}px`;
      div.appendChild(img);

      container.appendChild(div);
      pieces.push(div);
      id++;
    }
  }

  shuffle();
  addClickEvents();
}

// BloklarÄ± karÄ±ÅŸtÄ±r
function shuffle(){
  for(let i=0;i<100;i++){
    let movable = getMovable();
    let randomPiece = movable[Math.floor(Math.random()*movable.length)];
    movePiece(randomPiece);
  }
}

// BoÅŸ alan ile komÅŸu bloklar
function getMovable(){
  return pieces.filter(p=>{
    let row = parseInt(p.dataset.row);
    let col = parseInt(p.dataset.col);
    return (Math.abs(row-empty.row)+Math.abs(col-empty.col))===1;
  });
}

// Blok tÄ±klayÄ±nca boÅŸ alana kaydÄ±r
function addClickEvents(){
  pieces.forEach(p=>{
    p.addEventListener('click', ()=>{
      if(isMovable(p)) movePiece(p);
    });
  });
}

function isMovable(p){
  let row = parseInt(p.dataset.row);
  let col = parseInt(p.dataset.col);
  return (Math.abs(row-empty.row)+Math.abs(col-empty.col))===1;
}

function movePiece(p){
  let tempRow = parseInt(p.dataset.row);
  let tempCol = parseInt(p.dataset.col);

  p.dataset.row = empty.row;
  p.dataset.col = empty.col;
  p.style.top = `${empty.row*size}px`;
  p.style.left = `${empty.col*size}px`;

  empty.row = tempRow;
  empty.col = tempCol;

  checkWin();
}

// Kazanma kontrolÃ¼
function checkWin(){
  let correct = pieces.every(p=>{
    let id = parseInt(p.dataset.id);
    let row = parseInt(p.dataset.row);
    let col = parseInt(p.dataset.col);
    return id === row*3 + col +1;
  });
  if(correct){
    alert("ðŸŽ‰ Tebrikler! Yapbozu tamamladÄ±nÄ±z!");
  }
}
</script>
</body>
</html>
