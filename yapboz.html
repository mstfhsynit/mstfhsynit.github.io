<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Boş Alanlı Yapboz</title>
<style>
body {
  font-family: sans-serif;
  text-align: center;
  background: #eee;
  padding: 20px;
}
h1 { margin-bottom: 10px; }
#file-input { margin-bottom: 20px; }

#pieces-container {
  min-height: 70px;
  white-space: nowrap;
  overflow-x: auto;
  margin-bottom: 20px;
  border: 1px solid #aaa;
  padding: 5px;
  background: #fff;
}

.piece {
  width: 60px;
  height: 60px;
  display: inline-block;
  margin-right: 5px;
  border: 1px solid #333;
  position: relative;
  cursor: grab;
}

.piece img {
  width: 360px;
  height: 360px;
  object-fit: none;
  position: absolute;
  top: 0;
  left: 0;
  pointer-events: none;
}

#puzzle-area {
  width: 360px;
  height: 360px;
  margin: auto;
  position: relative;
  border: 2px solid #333;
  background-color: #fff;
}

#puzzle-area img {
  position: absolute;
  top:0;
  left:0;
  width:360px;
  height:360px;
  object-fit: cover;
  z-index:0;
}

#drop-slot {
  width: 120px;
  height: 120px;
  border: 2px dashed #555;
  position: absolute;
  top: 120px;
  left: 120px;
  background-color: rgba(255,255,255,0.2);
}
</style>
</head>
<body>
<h1>Boş Alanlı Yapboz</h1>
<input type="file" id="file-input" accept="image/*"><br>
<div id="pieces-container"></div>
<div id="puzzle-area">
  <img id="background" src="" alt="Alt Resim">
  <div id="drop-slot"></div>
</div>

<script>
const fileInput = document.getElementById('file-input');
const piecesContainer = document.getElementById('pieces-container');
const puzzleArea = document.getElementById('puzzle-area');
const background = document.getElementById('background');
const dropSlot = document.getElementById('drop-slot');

let pieces = [];
let imgSrc = "";
let currentPiece = null;

fileInput.addEventListener('change', e=>{
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = function(event){
    imgSrc = event.target.result;
    background.src = imgSrc;
    createPieces();
  }
  reader.readAsDataURL(file);
});

function createPieces(){
  piecesContainer.innerHTML="";
  pieces=[];
  const positions = [
    {row:0,col:0},{row:0,col:1},{row:0,col:2},
    {row:1,col:0},           {row:1,col:2},
    {row:2,col:0},{row:2,col:1},{row:2,col:2},
  ];
  positions.forEach((pos,index)=>{
    let div = document.createElement('div');
    div.className='piece';
    div.dataset.row=pos.row;
    div.dataset.col=pos.col;

    let img = document.createElement('img');
    img.src = imgSrc;
    img.style.top = `-${pos.row*120}px`;
    img.style.left = `-${pos.col*120}px`;

    div.appendChild(img);
    piecesContainer.appendChild(div);
    pieces.push(div);

    // Dokunmatik ve fare uyumlu sürükle bırak
    div.addEventListener('pointerdown', startDrag);
  });
}

function startDrag(e){
  currentPiece = e.currentTarget;
  currentPiece.setPointerCapture(e.pointerId);
  currentPiece.initialX = e.clientX;
  currentPiece.initialY = e.clientY;

  currentPiece.startLeft = currentPiece.offsetLeft;
  currentPiece.startTop = currentPiece.offsetTop;

  currentPiece.addEventListener('pointermove', drag);
  currentPiece.addEventListener('pointerup', endDrag);
  currentPiece.addEventListener('pointercancel', endDrag);
}

function drag(e){
  const dx = e.clientX - currentPiece.initialX;
  const dy = e.clientY - currentPiece.initialY;
  currentPiece.style.position="absolute";
  currentPiece.style.left = currentPiece.startLeft + dx + "px";
  currentPiece.style.top = currentPiece.startTop + dy + "px";
}

function endDrag(e){
  // Ortadaki boş alana bak
  const rect = dropSlot.getBoundingClientRect();
  const pieceRect = currentPiece.getBoundingClientRect();
  if(pieceRect.left + pieceRect.width/2 > rect.left &&
     pieceRect.left + pieceRect.width/2 < rect.right &&
     pieceRect.top + pieceRect.height/2 > rect.top &&
     pieceRect.top + pieceRect.height/2 < rect.bottom){
       // Orta boş alana yerleştir
       dropSlot.appendChild(currentPiece);
       currentPiece.style.position="relative";
       currentPiece.style.top="0";
       currentPiece.style.left="0";
       currentPiece.style.cursor="default";
  } else {
    // Eski konuma geri döndür
    currentPiece.style.left=currentPiece.startLeft+"px";
    currentPiece.style.top=currentPiece.startTop+"px";
  }

  currentPiece.releasePointerCapture(e.pointerId);
  currentPiece.removeEventListener('pointermove', drag);
  currentPiece.removeEventListener('pointerup', endDrag);
  currentPiece.removeEventListener('pointercancel', endDrag);
  currentPiece=null;
}
</script>
</body>
</html>
