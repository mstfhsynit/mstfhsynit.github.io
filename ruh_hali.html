<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CanlÄ± Ruh Hali Ultimate Sync</title>

<style>
body{
margin:0;
overflow:hidden;
font-family:Segoe UI,Arial;
background:linear-gradient(120deg,#222,#000);
color:white;
}

canvas{
position:fixed;
top:0;
left:0;
z-index:1;
}

#ui,#text,#stats{
position:fixed;
z-index:10;
}

#ui{
top:10px;
left:10px;
background:rgba(0,0,0,.6);
padding:14px;
border-radius:14px;
width:210px;
}

button,input{
width:100%;
margin:5px 0;
padding:8px;
border:none;
border-radius:10px;
font-weight:bold;
cursor:pointer;
}

#songName{
text-align:center;
font-size:14px;
margin:6px 0;
}

#text{
top:50%;
left:50%;
transform:translate(-50%,-50%);
font-size:2.3em;
text-align:center;
text-shadow:0 0 20px white;
}

#stats{
bottom:10px;
right:10px;
background:rgba(0,0,0,.6);
padding:12px;
border-radius:12px;
}
</style>
</head>
<body>

<canvas id="canvas"></canvas>

<div id="ui">
<button id="musicBtn">â–¶ï¸ MÃ¼ziÄŸi BaÅŸlat</button>

<div id="songName"></div>

<button onclick="prevSong()">â® Ã–nceki</button>
<button onclick="nextSong()">â­ Sonraki</button>

<label>ğŸ”Š Ses Seviyesi</label>
<input id="volume" type="range" min="0" max="1" step="0.01">
</div>

<div id="text">MÃ¼ziÄŸi baÅŸlat ğŸ¶</div>

<div id="stats">TÄ±klama: <span id="count">0</span></div>

<audio id="music"></audio>

<script>
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");

function resize(){
canvas.width=innerWidth;
canvas.height=innerHeight;
}
resize();
window.onresize=resize;

let waves=[];
let clicks=0;

// ğŸ¼ Playlist
const playlist=[
{name:"RahatlatÄ±cÄ± Melodi",src:"https://cdn.pixabay.com/audio/2022/03/09/audio_8e0e62bb79.mp3"},
{name:"Huzurlu Piyano",src:"https://cdn.pixabay.com/audio/2021/08/08/audio_884ee96b6c.mp3"},
{name:"Enerjik Beat",src:"https://cdn.pixabay.com/audio/2022/11/22/audio_3e5f3f28a3.mp3"}
];

let current=0;

const music=document.getElementById("music");
const volume=document.getElementById("volume");
const songName=document.getElementById("songName");
const musicBtn=document.getElementById("musicBtn");

volume.value=0.6;
music.volume=0.6;

function loadSong(){
music.src=playlist[current].src;
songName.innerText="ğŸ¼ "+playlist[current].name;
}
loadSong();

musicBtn.onclick=async()=>{
try{
await music.play();
musicBtn.innerText="â¸ Durdur";
}catch{
alert("Tekrar tÄ±kla!");
}
};

function nextSong(){
current=(current+1)%playlist.length;
loadSong();
music.play();
}

function prevSong(){
current--;
if(current<0) current=playlist.length-1;
loadSong();
music.play();
}

volume.oninput=()=>music.volume=volume.value;

// ğŸ¨ Efekt

function randomColor(){
return `hsl(${Math.random()*360},80%,60%)`;
}

function addWave(x,y){
waves.push({x,y,r:0,color:randomColor()});
}

function draw(){
ctx.clearRect(0,0,canvas.width,canvas.height);

waves.forEach((w,i)=>{
ctx.beginPath();
ctx.arc(w.x,w.y,w.r,0,Math.PI*2);
ctx.strokeStyle=w.color;
ctx.lineWidth=4;
ctx.stroke();
w.r+=5;
if(w.r>900) waves.splice(i,1);
});

requestAnimationFrame(draw);
}
draw();

document.body.addEventListener("click",e=>{
document.body.style.background=
`linear-gradient(120deg,${randomColor()},${randomColor()})`;

addWave(e.clientX,e.clientY);

clicks++;
count.innerText=clicks;

text.innerText="MÃ¼zikle senkron! ğŸµ";
});

// ğŸµ SENKRON ANALÄ°Z

const AudioContext=window.AudioContext||window.webkitAudioContext;
const audioCtx=new AudioContext();

const source=audioCtx.createMediaElementSource(music);
const analyser=audioCtx.createAnalyser();

source.connect(analyser);
analyser.connect(audioCtx.destination);

analyser.fftSize=256;

const bufferLength=analyser.frequencyBinCount;
const dataArray=new Uint8Array(bufferLength);

music.onplay=()=>{
if(audioCtx.state==="suspended") audioCtx.resume();
};

function musicReactive(){
analyser.getByteFrequencyData(dataArray);

let avg=0;
for(let i=0;i<bufferLength;i++) avg+=dataArray[i];
avg/=bufferLength;

let intensity=avg/255;

waves.forEach(w=>w.r+=intensity*12);

if(intensity>0.25){
document.body.style.background=
`linear-gradient(120deg,${randomColor()},${randomColor()})`;
}

requestAnimationFrame(musicReactive);
}
musicReactive();

</script>

</body>
</html>
