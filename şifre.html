<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Password Manager</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#020617">
<style>
*{box-sizing:border-box}
body{
margin:0;font-family:system-ui,sans-serif;
background:#020617;color:#e5e7eb;
min-height:100vh;display:flex;
justify-content:center;align-items:center}
.card{
width:100%;max-width:700px;margin:12px;
border:1px solid #1e293b;border-radius:18px;
padding:20px}
h2,h3{margin-top:0}
input,button,select{
width:100%;padding:12px;margin-top:10px;
border-radius:12px;border:none;font-size:16px}
input,select{
background:#020617;color:#e5e7eb;
border:1px solid #1e293b}
button{background:#2563eb;color:white}
.secondary{background:#334155}
.hidden{display:none}
.item{
border:1px solid #1e293b;border-radius:12px;
margin-top:10px}
.header{padding:10px;cursor:pointer}
.content{padding:10px;display:none}
.item.open .content{display:block}
.time{font-size:12px;opacity:.6}
.lang{
position:absolute;top:10px;right:10px;width:120px}
.modal{
position:fixed;inset:0;background:#000a;
display:flex;justify-content:center;align-items:center}
</style>
</head>

<body>

<select class="lang" onchange="setLang(this.value)">
<option value="tr">üáπüá∑ T√ºrk√ße</option>
<option value="en">üá¨üáß English</option>
</select>

<div class="card" id="auth"></div>
<div class="card hidden" id="app"></div>

<!-- IMPORT AUTH -->
<div id="importModal" class="modal hidden">
<div class="card">
<h3>üîê Hesap Doƒürulama</h3>
<input id="impUser" placeholder="Kullanƒ±cƒ± adƒ±">
<input id="impPass" type="password" placeholder="Master ≈üifre">
<button onclick="confirmImport()">Doƒürula</button>
<button class="secondary" onclick="closeImport()">ƒ∞ptal</button>
</div>
</div>

<script>
/* ===== LANGUAGE ===== */
const T={
tr:{create:"Hesap Olu≈ütur",login:"Giri≈ü Yap",user:"Kullanƒ±cƒ± adƒ±",
pass:"Master ≈üifre",pass2:"Master ≈üifre tekrar",
save:"Kaydet",export:"TXT Export",import:"Import",
label:"≈ûifre adƒ±",newpass:"Yeni ≈üifre",
search:"Ara",logout:"√áƒ±kƒ±≈ü"},
en:{create:"Create Account",login:"Login",user:"Username",
pass:"Master password",pass2:"Confirm password",
save:"Save",export:"TXT Export",import:"Import",
label:"Label",newpass:"New password",
search:"Search",logout:"Logout"}
};
let lang=localStorage.getItem("lang")||"tr";
document.querySelector(".lang").value=lang;
function setLang(l){lang=l;localStorage.setItem("lang",l);renderAuth()}

/* ===== ELEMENTS ===== */
const auth=document.getElementById("auth");
const app=document.getElementById("app");

/* ===== AUTH UI ===== */
function renderAuth(){
auth.innerHTML="";app.innerHTML="";
if(!localStorage.getItem("user")){
auth.innerHTML=`
<h2>${T[lang].create}</h2>
<input id="u" placeholder="${T[lang].user}">
<input id="p1" type="password" placeholder="${T[lang].pass}">
<input id="p2" type="password" placeholder="${T[lang].pass2}">
<button onclick="register()">${T[lang].create}</button>`;
}else{
auth.innerHTML=`
<h2>${T[lang].login}</h2>
<input id="u" placeholder="${T[lang].user}">
<input id="p" type="password" placeholder="${T[lang].pass}">
<button onclick="login()">${T[lang].login}</button>`;
}}
renderAuth();

/* ===== CRYPTO ===== */
let key;
async function derive(p,s){
const base=await crypto.subtle.importKey("raw",
new TextEncoder().encode(p),"PBKDF2",false,["deriveKey"]);
return crypto.subtle.deriveKey(
{name:"PBKDF2",salt:s,iterations:100000,hash:"SHA-256"},
base,{name:"AES-GCM",length:256},false,["encrypt","decrypt"]);
}
async function enc(t){
const iv=crypto.getRandomValues(new Uint8Array(12));
const d=await crypto.subtle.encrypt({name:"AES-GCM",iv},
key,new TextEncoder().encode(t));
return{iv:[...iv],d:[...new Uint8Array(d)]};
}
async function dec(o){
const d=await crypto.subtle.decrypt(
{name:"AES-GCM",iv:new Uint8Array(o.iv)},
key,new Uint8Array(o.d));
return new TextDecoder().decode(d);
}

/* ===== AUTH LOGIC ===== */
async function register(){
if(p1.value!==p2.value)return alert("≈ûifreler uyu≈ümuyor");
const salt=crypto.getRandomValues(new Uint8Array(16));
key=await derive(p1.value,salt);
localStorage.setItem("user",u.value);
localStorage.setItem("salt",JSON.stringify([...salt]));
open();
}
async function login(){
if(u.value!==localStorage.getItem("user"))
return alert("Kullanƒ±cƒ± adƒ± yanlƒ±≈ü");
const salt=new Uint8Array(JSON.parse(localStorage.getItem("salt")));
key=await derive(p.value,salt);
open();
}
function open(){
auth.classList.add("hidden");
app.classList.remove("hidden");
renderApp();
}

/* ===== APP ===== */
function now(){return new Date().toLocaleString();}
function renderApp(){
app.innerHTML=`
<h3>üîê Password Manager</h3>
<input id="label" placeholder="${T[lang].label}">
<input id="pw" type="password" placeholder="${T[lang].newpass}">
<button onclick="save()">${T[lang].save}</button>
<hr>
<button class="secondary" onclick="exportTXT()">${T[lang].export}</button>
<input type="file" id="file" hidden onchange="prepareImport(this)">
<button class="secondary" onclick="file.click()">${T[lang].import}</button>
<input id="search" placeholder="${T[lang].search}" oninput="load()">
<div id="list"></div>
<hr>
<button class="secondary" onclick="logout()">${T[lang].logout}</button>`;
load();
}
async function save(){
let v=JSON.parse(localStorage.getItem("vault")||"[]");
v.push({l:label.value,p:await enc(pw.value),
c:now(),u:"-"});
localStorage.setItem("vault",JSON.stringify(v));
label.value="";pw.value="";load();
}
async function load(){
list.innerHTML="";
let v=JSON.parse(localStorage.getItem("vault")||"[]");
v.forEach((x,i)=>{
if(!x.l.toLowerCase().includes(search.value.toLowerCase()))return;
list.innerHTML+=`
<div class="item">
<div class="header" onclick="this.parentNode.classList.toggle('open')">
<b>${x.l}</b><div class="time">${x.c}</div>
</div>
<div class="content">
<input id="p${i}" type="password">
<button onclick="show(${i})">üëÅÔ∏è</button>
</div></div>`;
});
}
async function show(i){
let v=JSON.parse(localStorage.getItem("vault"));
p=document.getElementById("p"+i);
p.value=await dec(v[i].p);
v[i].u=now();
localStorage.setItem("vault",JSON.stringify(v));
}

/* ===== EXPORT ===== */
async function exportTXT(){
let v=JSON.parse(localStorage.getItem("vault")||"[]");
let txt="";
for(const x of v){
txt+=`${x.l}\n≈ûifre: ${await dec(x.p)}\nOlu≈üturma: ${x.c}\nSon Kullanƒ±m: ${x.u}\n-----------------\n`;
}
const b=new Blob([txt],{type:"text/plain"});
const a=document.createElement("a");
a.href=URL.createObjectURL(b);
a.download="passwords.txt";
a.click();
}

/* ===== IMPORT (AUTH REQUIRED) ===== */
let importData=null;
async function prepareImport(input){
importData=JSON.parse(await input.files[0].text());
document.getElementById("importModal").classList.remove("hidden");
}
async function confirmImport(){
if(impUser.value!==importData.user)return alert("Kullanƒ±cƒ± adƒ± yanlƒ±≈ü");
try{
const salt=new Uint8Array(importData.salt);
await derive(impPass.value,salt);
localStorage.setItem("user",importData.user);
localStorage.setItem("salt",JSON.stringify(importData.salt));
localStorage.setItem("vault",importData.vault);
location.reload();
}catch{alert("Master ≈üifre yanlƒ±≈ü")}
}
function closeImport(){
document.getElementById("importModal").classList.add("hidden");
}

/* ===== LOGOUT ===== */
function logout(){
key=null;location.reload();
}
</script>

</body>
</html>
